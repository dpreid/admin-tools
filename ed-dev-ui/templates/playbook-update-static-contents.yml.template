---
- name: update static contents from git repo
  hosts: ${ANSIBLE_GROUP}
  become: yes
  gather_facts: no
  vars_files:
    - ../autogenerated/vars.yml
    
  tasks:
  
   - name: Create a directory for default index.html
     ansible.builtin.file:
       path: "/var/www/{{ domain }}/{{ instance_path }}"
       state: directory
       mode: '0755'
       
   - name: Create a directory for David's files if it does not exist
     ansible.builtin.file:
       path: "/var/www/{{ domain }}/{{ instance_path }}/david"
       state: directory
       mode: '0755' 

   - name: Create a directory for Sijie's static files if it does not exist
     ansible.builtin.file:
       path: "/var/www/{{ domain }}/{{ instance_path }}/sijie"
       state: directory
       mode: '0755'   
     
   - name: Create a directory for git repos if it does not exist
     ansible.builtin.file:
       path: "/var/www/git"
       state: directory
       mode: '0755'

   - name: Git checkout David's static repo
     ansible.builtin.git:
       repo: "{{ david_static_repo_url }}"
       dest: "/var/www/git/{{ david_static_repo_name }}"
	   
   - name: Git checkout Sijie's static repo
     ansible.builtin.git:
       repo: "{{ sijie_static_repo_url }}"
       dest: "/var/www/git/{{ sijie_static_repo_name }}"
	   
   - name: Create symbolic link for /{{ instance_path }}/index.html (use David's repo)
     ansible.builtin.file:
       src:  "/var/www/git/{{ david_static_repo_name }}/index.html"
       dest: "/var/www/{{ domain }}/{{ instance_path }}/index.html"
       state: link

   - name: Create symbolic link for /david/index.html 
     ansible.builtin.file:
       src:  "/var/www/git/{{ david_static_repo_name }}/index.html"
       dest: "/var/www/{{ domain }}/{{ instance_path }}/david/index.html"
       state: link

   - name: Create symbolic links for David's sub-directories
     ansible.builtin.file:
       src:  "/var/www/git/{{ david_static_repo_name }}/{{ item }}"
       dest: "/var/www/{{ domain }}/{{ instance_path }}/david/{{ item }}"
       state: link
     loop: "{{ david_static_sub_dirs }}"

   - name: Create symbolic link for /sijie/index.html 
     ansible.builtin.file:
       src:  "/var/www/git/{{ sijie_static_repo_name }}/index.html"
       dest: "/var/www/{{ domain }}/{{ instance_path }}/sijie/index.html"
       state: link

   - name: Create symbolic links for Sijie's sub-directories
     ansible.builtin.file:
       src:  "/var/www/git/{{ sijie_static_repo_name }}/{{ item }}"
       dest: "/var/www/{{ domain }}/{{ instance_path }}/sijie/{{ item }}"
       state: link
     loop: "{{ sijie_static_sub_dirs }}"




     

  

